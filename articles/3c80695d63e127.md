---
title: "Irisï¼ˆGo ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼‰ã®ä½¿ã„æ–¹ã‚’æœ€é€Ÿã§ãƒã‚¹ã‚¿ãƒ¼ã™ã‚‹"
emoji: "ğŸ¦¸ğŸ¼â€â™‚ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Go", "golang", "Iris", "iris"]
published: true
---

# ã¯ã˜ã‚ã«

https://www.iris-go.com

![Iris ãƒ­ã‚´](/images/go-iris-sample/iris_logo.png)
*Iris ã®ãƒã‚¹ã‚³ãƒƒãƒˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚‰ã—ã„ï¼ˆå¯æ„›ã„ï¼‰*

:::message alert
5, 6å¹´ã»ã©å‰ã«å®Ÿéš›ã«èµ·ããŸã“ã¨ã§ã™ãŒã€ Iris ã¯ã€ä½œè€…ãŒã‚³ãƒŸãƒƒãƒˆãƒ­ã‚°ã‚„ contributors ã‚’å…¨ã¦è‡ªåˆ†ã«å·®ã—æ›¿ãˆãŸã‚Šã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚„ issue ãªã©ã®æ‰±ã„æ–¹ãŒæ‚ªè³ªã§ã‚ã£ãŸãŒã‚†ãˆã« awesome-go ã¸ã®æ²è¼‰ã‚’æ‹’å¦ã•ã‚ŒãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
ã”ä½¿ç”¨ã®éš›ã¯ãã†ã„ã£ãŸç‚¹ã‚’ååˆ†ã«è€ƒæ…®ã—åˆ¤æ–­ã—ã¦ãã ã•ã„ã€‚
:::


# Irisï¼ˆã‚¢ã‚¤ãƒªã‚¹ï¼‰ã«ã¤ã„ã¦

Iris ã¯ Go ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ã†ã¡ã®1ã¤ã§ã™ã€‚

ãã®å¤§ããªç‰¹å¾´ã¨ã—ã¦ã¯ã¾ãšã€[å…¬å¼ã‚µã‚¤ãƒˆ](https://iris-go.com) ã§ã‚‚ã€Go ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ãªã‹ã§æœ€é€Ÿã€ã¨è¬³ã£ã¦ã„ã‚‹é€šã‚Šã€å®Ÿè¡Œé€Ÿåº¦ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚
[Iris ãŒå…¬é–‹ã—ã¦ã„ã‚‹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯](https://github.com/kataras/server-benchmarks?tab=readme-ov-file#server-benchmarks) ã«ã‚ˆã‚‹ã¨ã€ä»–ã®ä¸»è¦ãª Go ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨æ¯”è¼ƒã—ã¦æœ€ã‚‚é«˜ã„ã‚¹ã‚³ã‚¢ã‚’å‡ºã—ã¦ã„ã¾ã™ã€‚

![Iris ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯](/images/go-iris-sample/benchmark.png)

ãã®ä»–ã«ã¯ã€ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚ã‚‹ã“ã¨ã‚‚æŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚
Iris ã¯ã€ä¸Šè¿°ã®é«˜é€Ÿæ€§ã‚’Webã‚µãƒ¼ãƒãƒ¼ã‚„ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ãªã©ã®ç’°å¢ƒã‚’å•ã‚ãšç™ºæ®ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã¾ãŸã€MVCãƒ¢ãƒ‡ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ãªã©ã‚‚æŒ™ã’ã‚‰ã‚Œã¾ã™ãŒã€
ä»–ã«ã‚‚å¤šãã®æ©Ÿèƒ½ãŒæ­è¼‰ã•ã‚Œã¦ãŠã‚Šã€ã•ã‚‰ã« [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.iris-go.com/docs/)[^1] ã‚‚å……å®Ÿã—ã¦ã„ã‚‹ã“ã¨ãªã©ã‹ã‚‰åŠ¹ç‡è‰¯ãé–‹ç™ºãŒè¡Œãˆã¾ã™ã€‚


# Iris ã‚’ä½¿ã£ã¦ã¿ã‚‹ï¼ˆæº–å‚™ï¼‰

æ—©é€Ÿä½¿ã£ã¦ã„ãã¾ã™ã€‚

## 1. Go ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

[Go ã®å…¬å¼ã‚µã‚¤ãƒˆ](https://go.dev/dl/) ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‹ã€brew ã‚’ä½¿ç”¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
ï¼ˆã“ã“ã§ã¯ Go 1.21 ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚ï¼‰

```shell
$ brew install go
# ç¢ºèª
$ go version
go version go1.21.2
```

## 2. Iris ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```shell
$ mkdir myapp
$ cd myapp
$ go mod init myapp
$ go get -u github.com/kataras/iris/v12
```

[â€» ãã®ä»–å‚è€ƒã¯ã“ã¡ã‚‰](https://github.com/kataras/iris#-learning-iris)


# Iris ã‚’ä½¿ã£ã¦ã¿ã‚‹ï¼ˆåŸºæœ¬ç·¨ï¼‰

æº–å‚™ãŒå®Œäº†ã—ãŸã‚‰ã€Iris ã‚’ä½¿ã£ã¦ç°¡å˜ãªAPIã‚’ä½œæˆã—ã¦ã¿ã¾ã™ï¼ˆâ€» MVCãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã—ãªã„å ´åˆï¼‰

```go:main.go
package main

import "github.com/kataras/iris/v12"

func main() {
    app := iris.New()

    // ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è¨­å®š
    app.Handle("GET", "/", func(ctx iris.Context) {
        ctx.JSON(iris.Map{"message": "ping"})
    })
	
    app.Listen(":8080")
}
```

`go run main.go` ã§ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã¦ `localhost:8080` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€JSONã§ `{"message":"ping"}` ãŒè¿”ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

ä¸Šè¨˜ãŒåŸºæœ¬çš„ãªæ›¸ãæ–¹ã§ã™ãŒã€Iris ã§ã¯ã•ã‚‰ã« **ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ãƒ‘ã‚¹ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**
ã“ã‚Œã‚’ä½¿ã„ãªãŒã‚‰ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã® `func(ctx iris.Context) {...}` ç®‡æ‰€ã‚’é–¢æ•°ã¨ã—ã¦åˆ‡ã‚Šå‡ºã™ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```go:main.go
package main

import "github.com/kataras/iris/v12"

type Book struct {
    Title string `json:"title"`
}

func main() {
    app := iris.New()

    // ã€Œ/booksã€ã‹ã‚‰å§‹ã¾ã‚‹ãƒ‘ã‚¹ã«å¯¾ã™ã‚‹å‡¦ç†ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹
    booksAPI := app.Party("/books")
    {
        // GET: http://localhost:8080/books
        booksAPI.Get("/", list)
        // POST: http://localhost:8080/books
        booksAPI.Post("/", create)
    }
	
    app.Listen(":8080")
}

func list(ctx iris.Context) {
    books := []Book{
        {"Mastering Concurrency in Go"},
        {"Go Design Patterns"},
        {"Black Hat Go"},
    }
    ctx.JSON(books)
}

func create(ctx iris.Context) {
    var b Book
    err := ctx.ReadJSON(&b)
    if err != nil {
        ctx.StopWithProblem(iris.StatusBadRequest, iris.NewProblem().
            Title("Book creation failure").DetailErr(err))
        return
    }

    println("Received Book: " + b.Title)
    ctx.StatusCode(iris.StatusCreated)
}
```

å†åº¦ `go run main.go` ã§ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã¦ `localhost:8080/books` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ä»¥ä¸‹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

```
[{"title":"Mastering Concurrency in Go"},{"title":"Go Design Patterns"},{"title":"Black Hat Go"}]
````

## ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ä½¿ç”¨

Iris ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æ§˜ã€…ãªãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¨­å®šæ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

- Application.WrapRouter()
- Application.UseRouter() â‰’ Application.Use()
- Application.UseGlobal()
- Party.Use()
- Party.UseError()
- Party.Done()
- Application.DoneGlobal()

> ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’ä½¿ã†ã“ã¨ã§ã€ä¾‹ãˆã°CORSã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„èªè¨¼ã€ãƒ­ã‚®ãƒ³ã‚°ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãªã©ã®å…±é€šå‡¦ç†ã‚’ä¸€ç®‡æ‰€ã«é›†ç´„ã—å†åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ããŸã‚Šã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†ã‚’æŸ”è»Ÿã«åˆ¶å¾¡ã§ããŸã‚Šã¨å¤šãã®åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã“ã§ã® `Party` ã¯ `app.Party()` ã«ã‚ˆã£ã¦ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚ŒãŸãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ï¼ˆãƒ«ãƒ¼ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰ã®ã“ã¨ã§ã™ã€‚ï¼ˆä¾‹ï¼š `booksAPI := app.Party("/books")`ï¼‰
ãã‚Œãã‚Œå®Ÿè¡Œã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚„é©ç”¨ç¯„å›²ã€ç›®çš„ãªã©ãŒç•°ãªã‚‹ãŸã‚ã€ä»¥ä¸‹ï¼ˆâ†“ï¼‰ã«ã¾ã¨ã‚ã¾ã™ã€‚

| ãƒ¡ã‚½ãƒƒãƒ‰                                         | å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°                                                               | èª¬æ˜                                                                                                        |
|----------------------------------------------|-----------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
| Application.WrapRouter()                     | ãƒ«ãƒ¼ã‚¿ãƒ¼è‡ªä½“ã‚’ãƒ©ãƒƒãƒ—ã—ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ«ãƒ¼ã‚¿ãƒ¼ï¼‰ã«åˆ°é”ã™ã‚‹å‰ã«å®Ÿè¡Œã•ã‚Œã‚‹                          | ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒèµ·ã“ã‚‹å‰æ®µéšã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã¦ä½•ã‹å…±é€šã®å‡¦ç†ã‚’è¡Œã„ãŸã„å ´åˆã«ä½¿ç”¨ã™ã‚‹                                                                |
| Application.UseGlobal()ï¼ˆâ‰’ Application.Use()ï¼‰ | å…¨ã¦ã®ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒåˆ°é”ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã•ã‚Œã‚‹ï¼ˆå„ªå…ˆé †ä½ã¯ Application.WrapRouter() ã®å¾Œï¼‰ | ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªå‰å‡¦ç†ã«é©ã—ã¦ã„ã‚‹ã€‚ï¼ˆApplication.Use()ã‚‚åŒã˜ã‚ˆã†ãªå‹•ä½œã‚’ã™ã‚‹ãŒã€Application.UseGlobal() ã¯é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚„ãƒ«ãƒ¼ã‚¿ãƒ¼å¤–ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã‚‚é©ç”¨ã•ã‚Œã‚‹ã€‚ï¼‰ |
| Application.UseRouter()                      | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«åˆ°é”ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã€å®šç¾©ã•ã‚ŒãŸã©ã‚Œã‹ã®ï¼ˆã©ã‚Œã§ã‚‚OKï¼‰ãƒ«ãƒ¼ãƒˆã«ãƒãƒƒãƒã—ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒè¡Œã‚ã‚Œã‚‹ç›´å‰ã«å®Ÿè¡Œã•ã‚Œã‚‹     | å…¨ã¦ã®ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå®šç¾©ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã«ãƒãƒƒãƒã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ä½•ã‹å‰å‡¦ç†ã‚’è¡Œã„ãŸã„å ´åˆã«ä½¿ç”¨ã™ã‚‹                                                           |
| Party.Use()                                  | ç‰¹å®šã®ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ï¼ˆãƒ«ãƒ¼ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰å†…ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã®ã¿å®Ÿè¡Œã•ã‚Œã‚‹                                     | ç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ—ã«å…±é€šã®å‰å‡¦ç†ã‚’è¡Œã„ãŸã„å ´åˆã«ä½¿ç”¨ã™ã‚‹                                                                            |
| Party.UseError()                             | ç‰¹å®šã®ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ï¼ˆãƒ«ãƒ¼ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰å†…ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã£ãŸéš›ã«å®Ÿè¡Œã•ã‚Œã‚‹                                   | ç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ—å†…ã§ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã«å…±é€šã®å‡¦ç†ã‚’è¡Œã„ãŸã„å ´åˆã«ä½¿ç”¨ã™ã‚‹                                                                    |
| Party.Done()                                 | ç‰¹å®šã®ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ï¼ˆãƒ«ãƒ¼ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰å†…ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå‡¦ç†ã•ã‚ŒãŸç›´å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹                               | ç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ—ã«å…±é€šã®å¾Œå‡¦ç†ã‚’è¡Œã„ãŸã„å ´åˆã«ä½¿ç”¨ã™ã‚‹                                                                            |
| Application.DoneGlobal()                     | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå‡¦ç†ã•ã‚ŒãŸå¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹                                         | å…¨ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®çµ‚äº†å¾Œã®å…±é€šå‡¦ç†ã‚’è¡Œã„ãŸã„å ´åˆã«ä½¿ç”¨ã™ã‚‹                                                                             |


ã•ã‚‰ã«ã€ä¸Šè¿°ã®æ–¹æ³•ã‚’ä½¿ã„ã‚«ã‚¹ã‚¿ãƒ ã—ãŸè‡ªä½œãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’è¨­å®šã§ãã‚‹ã“ã¨ã¯ã‚‚ã¡ã‚ã‚“ã€Iris ã«ã¯å‚™ãˆä»˜ããƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚‚è±Šå¯Œã«ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ãŸã‚ãã‚Œã‚‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚
ãã‚Œãã‚Œã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ä½¿ã„æ–¹ã‚„æ©Ÿèƒ½ã«ã¤ã„ã¦ã¯ [å…¬å¼ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/iris-contrib/middleware) ã‚„ [å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.iris-go.com/docs/#/?id=using-middleware) ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

```go:main.go
package main

import (
    "net/http"

    "github.com/kataras/iris/v12"
)

func main() {
    app := iris.New()

    app.UseRouter(recover.New())
    
    app.Get("/benchmark", MyBenchLogger(), benchEndpoint)

    authorized := app.Party("/")
    authorized.Use(AuthRequired())
    {
        authorized.Post("/login", loginEndpoint)
        authorized.Post("/submit", submitEndpoint)
        authorized.Post("/read", readEndpoint)
    }

    app.Listen(":8080")
}
```

## HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹

ã¾ãšã¯ã€`app.RegisterView()` ã¨ã„ã† Iris ã®çµ„ã¿è¾¼ã¿é–¢æ•°ã‚’ä½¿ã„ã€è¡¨ç¤ºã™ã‚‹HTMLãƒ•ã‚¡ã‚¤ãƒ«ãŒæ ¼ç´ã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãã®ä¸­ã®ã©ã®ç¨®é¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`.html` ãªã©ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã‹ã®æŒ‡å®šã‚’ã—ã¾ã™ã€‚
ã“ã‚Œã¯åŸºæœ¬çš„ã«ã¯ã‚³ãƒ¼ãƒ‰ã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§ä¸€åº¦ã ã‘è¡Œã†ã‚ˆã†ã«ã—ã€æŒ‡å®šã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¢—ã‚„ã—ã¦ã„ãã‚ˆã†ã«ã—ã¾ã™ã€‚ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ä¸­ã«éƒ½åº¦å‘¼ã¶ã®ã¯å†—é•·ãªã®ã§å…±é€šåŒ–ã™ã‚‹ãŸã‚ãªã©ã®ç†ç”±ã‹ã‚‰ã§ã™ã€‚
ï¼ˆã‚‚ã¡ã‚ã‚“ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã‚ˆã£ã¦ã€ã¾ãŸã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡ã«ã‚ˆã£ã¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¤‰ãˆã‚‹ã¨ã„ã†ä½¿ã„æ–¹ã‚‚ã§ãã¾ã™ã€‚ãã®å ´åˆã¯ `app.RegisterView()` ã‚’é©åˆ‡ã«å‘¼ã³å‡ºã—ã¾ã—ã‚‡ã†ã€‚ï¼‰

ãã®å¾Œãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®è¨­å®šã‚’ã—ã¾ã™ã€‚ 

```:ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
myapp
|- public
|- |- books
|- |- |- list.html
|- |- |- purchase.html
|- go.mod
|- main.go
```

```go:main.go
package main

import "github.com/kataras/iris/v12"

func main()  {
    app := iris.New()
    
    // public ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã® .html ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿”å´ã™ã‚‹ã‚ˆã†ã«è¨­å®š
    app.RegisterView(iris.HTML("/public", ".html"))
    
    // GET: "http://localhost:8080/"
    app.Get("/", func(ctx iris.Context) {
        // è¿”å´ã™ã‚‹HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ public ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã®ãƒ‘ã‚¹ã§æŒ‡å®šã™ã‚‹ï¼‰
        ctx.View("index.html")
    })

    // ã€Œ/booksã€ã‹ã‚‰å§‹ã¾ã‚‹ãƒ‘ã‚¹ã‚’å—ã‘å–ã‚‹å‡¦ç†ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
    // ãƒ•ã‚¡ã‚¤ãƒ«ã¯ public ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã®ãƒ‘ã‚¹ã§æŒ‡å®š
	books := app.Party("/books")
	{
		// GET: http://localhost:8080/books
		books.Get("/", func(ctx iris.Context) {
			err := ctx.View("/books/list.html")
			if err != nil {
				return
			}
		})
		// GET: http://localhost:8080/books/purchase
		books.Get("/purchase", func(ctx iris.Context) {
			err := ctx.View("/books/purchase.html")
			if err != nil {
				return
			}
		})
	}
    
    app.Listen(":8080")
}
```

`go run main.go` ã§ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã¦ `localhost:8080` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€`public/index.html` ã®å†…å®¹ãŒç¢ºèªã§ãã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

## é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹

åŒã˜ã‚ˆã†ã«ã€Iris ã®çµ„ã¿è¾¼ã¿é–¢æ•°ã§ã‚ã‚‹ `app.HandleDir()` ã‚’ä½¿ç”¨ã—ã¦ã€

```go
api.HandleDir("URI", iris.Dir("è¡¨ç¤ºã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ç”»åƒãŒã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¾ã§ã®ãƒ‘ã‚¹"), iris.DirOptions{è¡¨ç¤ºã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢ã™ã‚‹è¨­å®š})
```

ã¨è¨­å®šã§ãã¾ã™ã€‚
 
```go:main.go
package main

import "github.com/kataras/iris/v12"

func main()  {
    app := iris.New()
    
    // é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®è¡¨ç¤º
    // public ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã® index.html ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã™ã‚‹
    app.HandleDir("/", iris.Dir("/public"), iris.DirOptions{IndexName: "/index.html", Compress: true})
    
    app.Listen(":8080")
}
```

`go run main.go` ã§ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã¦ `localhost:8080` ã‚’ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€`public` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã® index.html ã®å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚
ã‚‚ã¡ã‚ã‚“ãã®ä»–ã®ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ç”»åƒãªã©ã«é–¢ã—ã¦ã‚‚æŒ‡å®šã§ãã¾ã™ã€‚

[â€» ãã®ä»–ã®ä½¿ç”¨ä¾‹ã¯ã“ã¡ã‚‰](https://github.com/kataras/iris/tree/main/_examples/file-server)

## ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã«é–¢ã—ã¦ã¯ã€

- `ctx.FormFile()`
- `ctx.FormFiles()`
- `ctx.SaveFormFile()`
- `ctx.UploadFormFiles()`

ãªã©ãŒå‚™ã‚ã£ã¦ã„ã¾ã™ã€‚

| ãƒ¡ã‚½ãƒƒãƒ‰            | æ©Ÿèƒ½                         |
|-----------------|----------------------------|
| ctx.FormFile()  | å˜æ•°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿                 |
| ctx.FormFiles() | è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿                 |
| ctx.SaveFormFile()  | å˜æ•°ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ï¼ˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰           |
| ctx.UploadFormFiles()  | å˜æ•°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»è¤‡æ•°èª­ã¿è¾¼ã¿ + ä¿å­˜ï¼ˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰ |

[è©³ã—ãã¯ã“ã¡ã‚‰](https://github.com/kataras/iris/blob/main/context/context.go#L2331)

`ctx.FormFile()` ã¨ `ctx.FormFiles()` ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ãã‚Œãã‚Œå˜æ•°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚
èª­ã¿è¾¼ã‚“ã ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `ctx.SaveFormFile()` ã«ã‚ˆã£ã¦æŒ‡å®šã—ãŸãƒ‘ã‚¹ã¸ã¨ä¿å­˜ãŒå¯èƒ½ã§ã™ãŒã€**ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯å˜æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã—ã‹å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚**

ã—ãŸãŒã£ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸè¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ã«ã¯ `ctx.UploadFormFiles()` ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
`ctx.UploadFormFiles()` ã¯ã€`ctx.FormFile()` / `ctx.FormFiles()` ã‚’ä½¿ã£ãŸå˜æ•°ãƒ»è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã¨ `ctx.SaveFormFile()` ã®ä¿å­˜ã‚’ä¸€æ°—ã«è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚
**ãŸã ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã å¾Œã«ãã‚Œã‚’ä½¿ã£ãŸä½•ã‚‰ã‹ã®å‡¦ç†ã‚„æ“ä½œã‚’è¡Œã„ã€ãã®å¾Œã«ä¿å­˜ã™ã‚‹ã€ã¨ã„ã£ãŸã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚**

ã§ã™ã®ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸã„å ´åˆã¯ãªã‚‹ã¹ã `ctx.FormFile()` ã«ã‚ˆã‚‹å˜æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ + `ctx.SaveFormFile()` ã«ã‚ˆã‚‹ä¿å­˜ã®çµ„ã¿åˆã‚ã›ã‚’ä½¿ã†ã®ãŒå¤‰æ›´ã¸ã®å¯¾å¿œãŒã—ã‚„ã™ããƒ™ã‚¿ãƒ¼ã¨ã„ãˆã¾ã™ã€‚

```go:main.go
const maxSize = 8 * iris.MB // 8MB

func main() {
    app := iris.New()

    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¸Šã§èª­ã¿è¾¼ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€å¤§å®¹é‡ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§32MBã§ã™ãŒã€ä»¥ä¸‹ã®æ–¹æ³•ã«ã‚ˆã£ã¦å¤‰ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ 
    // 1. ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦è¨­å®šã™ã‚‹ 
    app.Use(iris.LimitRequestBodySize(maxSize)
    // 2. ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å†…ã§ ctx.SetMaxRequestBodySize() ã‚’ä½¿ã„è¨­å®šã™ã‚‹ï¼ˆä¸‹å‚è€ƒâ†“ï¼‰
    // 3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•æ™‚ã« iris.WithPostMaxMemory() ã‚’ä½¿ã„è¨­å®šã™ã‚‹ï¼ˆä¸‹å‚è€ƒâ†“ï¼‰

    // å˜æ•°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ + ä¿å­˜
    app.Post("/upload", func(ctx iris.Context) {
        ctx.SetMaxRequestBodySize(maxSize)
		
        file, fileHeader, err:= ctx.FormFile("file")
        if err != nil {
            ctx.StopWithError(iris.StatusBadRequest, err)
            return
        }
        // ä¿å­˜å…ˆã‚’ä½œæˆã—ã¦ãŠã
        // ã“ã“ã§ã¯ destination ã« "./public/ãƒ•ã‚¡ã‚¤ãƒ«å" ã¨ã„ã†ãƒ‘ã‚¹ãŒæ–‡å­—åˆ—ã§æ ¼ç´ã•ã‚Œã‚‹
        destination := filepath.Join("./public", fileHeader.Filename)
        // ä¿å­˜å‡¦ç†
        ctx.SaveFormFile(fileHeader, destination)
    })

    // è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ + ä¿å­˜
	app.Post("/upload", func(ctx iris.Context) {
		// èª­ã¿è¾¼ã¿ + ä¿å­˜å‡¦ç†
        files, n, err := ctx.UploadFormFiles("./uploads")
		if err != nil {
            ctx.StopWithStatus(iris.StatusInternalServerError)
            return
		}
	})

    app.Listen(":8080", iris.WithPostMaxMemory(maxSize))
}
```

## ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—

ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯URLã®ä¸€éƒ¨ã¨ã—ã¦é€ä¿¡ã•ã‚Œã‚‹ã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢ã§ã™ã€‚ã“ã‚Œã‚‰ã¯é€šå¸¸URLã®æœ«å°¾ã§ã€Œ?ã€ã®å¾Œã«è¿½åŠ ã•ã‚Œã€è¤‡æ•°ã®ã‚¯ã‚¨ãƒªãŒã‚ã‚‹å ´åˆã¯ã€Œ&ã€ã§åŒºåˆ‡ã‚‰ã‚Œã¾ã™ã€‚

```
http://example.com/products?category=books&sort=asc
```

ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—ã«ã¯ã€

- `ctx.ReadQuery()`
- `ctx.URLParam()`

ãªã©ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```go:main.go
package main

import "github.com/kataras/iris/v12"

type MyType struct {
    // "url" ã‚¿ã‚°ã§ã‚¯ã‚¨ãƒªåã‚’æŒ‡å®šã—ã¦ã„ã¾ã™
    Name string `url:"name,required"`
    Age  int    `url:"age"`
}

func main()  {
    app := iris.New()
    
    // GET: "http://localhost:8080/users?name=tom&?age=19"
    app.Handle("GET", "/users", func(ctx iris.Context) {
        var t MyType
        // ReadQuery()ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è§£æã—ãã“ã‹ã‚‰ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€
        // å—ã‘å–ã£ãŸãƒ‡ãƒ¼ã‚¿ã‚’æ§‹é€ ä½“ï¼ˆstructï¼‰ã«æ ¼ç´ã—ã¾ã™ã€‚
        err := ctx.ReadQuery(&t)
        
        // å‡¦ç†...
    })
    
    // GET: "http://localhost:8080/users?name=tom&?age=19"
    app.Handle("GET", "/users", func(ctx iris.Context) {
        // ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ "name" ã®å€¤ã‚’å–å¾—
        name := c.Ctx.URLParam("name")
        
        // ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ "age" ã®å€¤ã‚’å–å¾—
        name := c.Ctx.URLParam("age")
        
        // å‡¦ç†...
    })
    
    app.Listen(":8080")
}
```

## ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—

ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯URLã®ãƒ‘ã‚¹éƒ¨åˆ†ã«åŸ‹ã‚è¾¼ã¾ã‚ŒãŸå‹•çš„ãªå€¤ã§ã™ã€‚ãŸã¨ãˆã°ã€Œ/users/{id}ã€ã®ã‚ˆã†ãªãƒ«ãƒ¼ãƒˆå®šç¾©ã«ãŠã‘ã‚‹ã€Œ{id}ã€ãŒãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ã€‚

```
http://example.com/users/1
```

ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—ã«ã¯

- `ctx.Params().Get()`

ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```go:main.go
package main

import "github.com/kataras/iris/v12"

func main()  {
    app := iris.New()
    
    // GET: "http://localhost:8080/users/1"
    app.Handle("GET", "/users/{id:int}", func(ctx iris.Context) {
        // ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ "id" ã®å€¤ã‚’å–å¾—
        id, _ := ctx.Params().Get("id")
        
        // å‡¦ç†...
    })
}
```


# Iris ã‚’ä½¿ã£ã¦ã¿ã‚‹ï¼ˆMVCç·¨ï¼‰

ã•ã¦ã€[åŸºæœ¬ç·¨](https://zenn.dev/mkosakana/articles/3c80695d63e127#iris-ã‚’ä½¿ã£ã¦ã¿ã‚‹ï¼ˆåŸºæœ¬ç·¨ï¼‰) ã®ä¸­ã§ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã¯ã©ã‚Œã‚‚ä»¥ä¸‹ã®ã‚ˆã†ã«ã€å—ã‘å–ã‚‹URLã¨ãã®å¾Œã®å‡¦ç†ã‚’â€ãƒ™ã‚¿æ›¸ãâ€ã—ãŸã‚‚ã®ã«éãã¾ã›ã‚“ã€‚

```go
app.Handle("GET", "/", func(ctx iris.Context) {
	ctx.JSON(iris.Map{"message": "ping"})
})
```

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¤§ãããªã‚‹ã«ã¤ã‚Œã¦ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯è‚¥å¤§åŒ–ã™ã‚‹ãŸã‚ã€æœ¬æ¥ã¯ä»Šå›å®Ÿè£…ã™ã‚‹MVCãƒ¢ãƒ‡ãƒ«ã‚„DDDã€ä½•ã‚‰ã‹ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å°å…¥ã—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å„éƒ¨åˆ†ã®è²¬å‹™ã‚’æ˜ç¢ºã«åˆ†é›¢ã™ã‚‹ã¹ãã§ã™ã€‚
ãã‚Œã«ã‚ˆã‚Šã€å†åˆ©ç”¨æ€§ã¨æ‹¡å¼µæ€§ãŒå‘ä¸Šã—ä¿å®ˆãŒå®¹æ˜“ã«ãªã‚‹ãŸã‚ã§ã™ã€‚

[Irisï¼ˆã‚¢ã‚¤ãƒªã‚¹ï¼‰ã«ã¤ã„ã¦](https://zenn.dev/mkosakana/articles/3c80695d63e127#irisï¼ˆã‚¢ã‚¤ãƒªã‚¹ï¼‰ã«ã¤ã„ã¦) ã§ã‚‚èª¬æ˜ã—ãŸé€šã‚Šã€Iris ã«ã¯ã€MVCãƒ¢ãƒ‡ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™ã€‚
ã“ã“ã§ã¯ãã‚Œã‚’ä½¿ã„ã€ç°¡å˜ãªMVCãƒ¢ãƒ‡ãƒ«ã®APIã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚

:::details å®Ÿè£…æ©Ÿèƒ½

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã™ã‚‹CRUDæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

| æ©Ÿèƒ½   | ãƒ¡ã‚½ãƒƒãƒ‰   | URI                                                |
|------|--------|----------------------------------------------------|
| æ–°è¦ä½œæˆ | POST   | http://localhost:8080/users (jsonã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã§ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹) |
| ä¸€è¦§å–å¾— | GET    | http://localhost:8080/users/list                   |
| æ›´æ–°   | PUT    | http://localhost:8080/users/details/{id:uint}      |
| å‰Šé™¤   | DELETE | http://localhost:8080/users/details/{id:uint}      |

:::

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
example-mvc-api
|- controller
|- |- users
|- |- |- users_controller.go
|- setups
|- |- configure_users_controllers.go  // ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰ã‚’è¡Œã†ç®‡æ‰€
|- model
|- |- user.go
|- service
|- |- user.go
|- go.mod
|- main.go
```

ã¾ãŸã€ä»Šå›DBã¨ã®ã‚„ã‚Šã¨ã‚Šã‚’è¡Œã†ãŸã‚ã®ORMã«é–¢ã—ã¦ã¯ [gorp](https://github.com/go-gorp/gorp) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

## main.go

ã“ã“ã§ã®ãƒã‚¤ãƒ³ãƒˆã¯ã€`mvc.Configure(users, setups.ConfigureUsersControllers)` ã®ç®‡æ‰€ã§ã™ã€‚
ã“ã‚Œã¯ `github.com/kataras/iris/v12/mvc` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® `Configure()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚`mvc.Configure()` ã¯ Iris ã®MVCãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€ ç‰¹å®šã®ãƒ‘ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾ã—ã¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚„ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã“ã¨åŠã³ä¾å­˜æ€§ã®æ³¨å…¥ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
[å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰](https://github.com/kataras/iris/blob/main/mvc/mvc.go#L93) ã‚’è¦‹ã‚Œã°åˆ†ã‹ã‚Šã¾ã™ãŒã€å†…éƒ¨çš„ã«ã€åŒã˜ã `github.com/kataras/iris/v12/mvc` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã® `mvc.New("ãƒ‘ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—").Configure()` ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ãŸã‚ã€ãã†æ›¸ã„ã¦ã‚‚åŒã˜ã§ã™ã€‚

`iris.New()` ã«ã‚ˆã£ã¦å¾—ã‚‰ã‚Œã‚‹ Iris æœ¬ä½“ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã€æ‰‹å‹•ã§å…¨ãƒ‘ã‚¹æ¯ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚„ãƒ¢ãƒ‡ãƒ«ã€ãƒ“ãƒ¥ãƒ¼ã®é–¢é€£ä»˜ã‘ã¨ç®¡ç†ã‚’è¡Œãˆã°MVCãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…ã¯å¯èƒ½ã§ã™ãŒã€
`mvc.Configure()` ã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®åˆæœŸåŒ–ã‚„ä¾å­˜é–¢ä¿‚ã®æ³¨å…¥ãªã©ã€å¤šãã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚ã¤ã¾ã‚Šãã¡ã‚‰ã‚’ä½¿ç”¨ã™ã‚‹æ–¹ãŒã€MVCãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…ãŒã‚ˆã‚Šç°¡å˜ã§åŠ¹ç‡çš„ã«ãªã‚Šã¾ã™ã€‚ç‰¹ã«ã€å¤§è¦æ¨¡ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒã¤ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ `mvc.Configure()` ã®æ–¹ãŒé©åˆ‡ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¨ã„ãˆã‚‹ã§ã—ã‚‡ã†ã€‚

```go:main.go
package main

import (
    "github.com/kataras/iris/v12"
    "github.com/kataras/iris/v12/middleware/accesslog"
    "github.com/kataras/iris/v12/middleware/recover"
    "github.com/kataras/iris/v12/mvc"
	
    "go-iris-sample/setups"
)

func main() {
    app := iris.New()

    app.UseRouter(recover.New())

    // ã€Œ/usersã€ã‹ã‚‰å§‹ã¾ã‚‹ãƒ‘ã‚¹ã‚’å—ã‘å–ã‚‹å‡¦ç†ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
    users := app.Party("/users")
    mvc.Configure(users, setups.ConfigureUsersControllers)

    // ãƒãƒ¼ãƒˆã®æŒ‡å®š
    app.Listen(":8080")
}
```

## setups/configure_users_controllers.goï¼ˆä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰ã‚’è¡Œã†ï¼‰

APIé–‹ç™ºã«ãŠã„ã¦ã€ç‰¹å®šã®ãƒ‘ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆä¾‹ãˆã°ã€Œ/usersã€ï¼‰ã§ç‰¹å®šã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚„ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆä¾‹ãˆã° UsersController ã‚„ UserServiceï¼‰ã‚’ä½¿ã†ã‚ˆã†ã«è¨­å®šã—ã€é–¢é€£ã—ãªã„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚„ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆä¾‹ãˆã° BooksController ã‚„ AnimalControllerï¼‰ãŒèª¤ã£ã¦å‹•ä½œã—ãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã¯ã€ä¸€èˆ¬çš„ã«è‰¯ã„è¨­è¨ˆã®ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã™ã€‚
**Iris ã§MVCãƒ¢ãƒ‡ãƒ«ã‚’å½¢æˆã™ã‚‹éš›ã«ã‚‚ã€ä½œæˆã—ãŸãƒ‘ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾ã—ã¦ä½¿ç”¨ã™ã‚‹ controller ã‚„ãã“ã§ä½¿ç”¨ã™ã‚‹ serviceã€ã¾ãŸã¯DBè¨­å®šãªã©ã‚’ã®ä¾å­˜æ€§æ³¨å…¥ï¼ˆDIï¼‰ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚**
ä»Šå›ã¯ãã‚Œã‚’ã“ã® `setups` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§è¡Œãªã£ã¦ã„ã¾ã™ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®åå‰ã¯ä½•ã§ã‚‚å¤§ä¸ˆå¤«ã§ã™ï¼‰

```go:setups/configure_users_controllers.go
import (
    "github.com/kataras/iris/v12/middleware/accesslog"
    "github.com/kataras/iris/v12/mvc"
    "go-iris-sample/controller/users"
    "go-iris-sample/service/users"
)

// ConfigureUsersControllers
// main.go ã§å®šç¾©ã—ãŸç‰¹å®šã®ãƒ‘ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆã“ã“ã§ã¯ã€Œ/usersã€ï¼‰ã«å¯¾ã—ã¦å¿…è¦ãª controller ã‚„ serviceã€åŠã³DBæ¥ç¶šè¨­å®šãªã©ã®DIï¼ˆä¾å­˜æ€§æ³¨å…¥ï¼‰ã‚’è¡Œã£ã¦ã„ã‚‹
func ConfigureUsersControllers(app *mvc.Application) {
    setBaseConfiguration(app)
    app.Register(users.NewUserService)
    app.Handle(new(users.UsersController))
}

func setBaseConfiguration(app *mvc.Application) {
	// DBåˆæœŸåŒ–
	db, err := initDb()
	if err != nil {
		log.Fatalf("func %s failed: %v", "InitDb", err)
	}
	app.Register(db)
}

// gorpåˆæœŸåŒ–å‡¦ç†
func initDb() *gorp.DbMap {
    dbUserName := "DB_USERNAME"
    dbPassWord := "DB_PASSWORD"
    dbHost := "DB_HOST"
    dbPort := "DB_PORT"
    dbDbName := "DB_DBNAME"
    db, err := sql.Open("mysql", fmt.Sprintf("%v:%v@tcp(%v:%v)/%v?parseTime=true", dbUserName, dbPassWord, dbHost, dbPort, dbDbName))
    if err != nil {
        fmt.Printf("error! can't open sql driver %v", err)
    }
    dbmap := &gorp.DbMap{Db: db, Dialect: gorp.MySQLDialect{"InnoDB", "UTF8"}}
    
   // ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
    dbmap.AddTableWithName(model.User{}, "user").SetKeys(true, "Id")
    err = dbmap.CreateTablesIfNotExists()
    if err != nil {
        fmt.Printf("error! can't craete table: %v", err)
    }
    
    // ãƒ­ã‚°ã®å–å¾—
    dbmap.TraceOn("[gorp]", log.New(os.Stdout, "go-iris-sample:", log.Lmicroseconds))
    
    return dbmap
}
```

## controller/users/users_controller.goï¼ˆãƒã‚¤ãƒ³ãƒˆâ‘¡ï¼‰

ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ UserService ã«å‘½ä»¤ã‚’è¡Œã„ã¾ã™ã€‚

ã•ã¦ã€`main.go` ã§ã€Œ/usersã€ã®ãƒ‘ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œã‚Šã¾ã—ãŸãŒã€ã“ã“ã§ä»Šå›ä½œæˆã™ã‚‹APIã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåï¼ˆå—ã‘å–ã‚‹URLï¼‰ã‚’å†ã³ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
- /users
- /users/list
- /users/details/{id:uint}
- /users/details/{id:uint}

ã©ã‚Œã‚‚ã€Œ/usersã€ã‹ã‚‰ãƒ‘ã‚¹ãŒå§‹ã¾ã‚Šã¾ã™ãŒã€ã€Œ/users/listã€ã‚„ã€Œ/users/detailsã€ãªã©ã®ã‚ˆã†ã«URLã¯åˆ†å²ã—ã¦ã„ã¾ã™ã€‚

[åŸºæœ¬ç·¨](https://zenn.dev/mkosakana/articles/3c80695d63e127#iris-ã‚’ä½¿ã£ã¦ã¿ã‚‹ï¼ˆåŸºæœ¬ç·¨ï¼‰) ã§æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ã«ã€`app.Get("GET", "/users/list", å‡¦ç†...)`ã€`app.Get("GET", "/users/details", å‡¦ç†...)` ã¨ã„ã†ã‚ˆã†ã«ã€URLã¨ãã‚Œã«ç´ã¥ã‘ã‚‹å‡¦ç†ã‚’â€ãƒ™ã‚¿æ›¸ãâ€ã—ãŸé–¢æ•°ã‚’ãŸãã•ã‚“ä½œã£ã¦ã„ãã®ã¯å¤§å¤‰ã§ã™ã€‚
ã‹ã¨ã„ã£ã¦ã€Œ/usersã€ã®ã‚ˆã†ã«åŒã˜ãƒ‘ã‚¹ã«ã®ã¿ã«ã—ã‹ GET/POST/PUT/DELETE... æ¯ã®å‡¦ç†ã‚’ä½œã‚Œãªã„ã¨ãªã‚‹ã¨æ‹¡å¼µæ€§ãŒä½ã„ã§ã™ã€‚

**Irisï¼ˆã®MVCã‚µãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼‰ã§ã¯ã€URLãƒ«ãƒ¼ãƒˆã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹æ©Ÿèƒ½ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚**
å…·ä½“çš„ã«ã¯ã€**ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®åå‰ã‚’å¤‰ãˆã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€åŒã˜ãƒ‘ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å†…ã§ã®ç´°ã‹ã„ãƒ‘ã‚¹ã®é•ã„ã«å¯¾å¿œã§ãã¾ã™ã€‚**

ä¾‹ãˆã° `main.go` ãªã©ã§URLã®ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ç´ä»˜ã‘ã‚’ã—ãŸã®ã¡ï¼ˆä»Šå›ã¯ã€Œ/usersã€ï¼‰ã€GET ã§ `/users/list` ã¨ã„ã†URLã‚’å—ã‘å–ã‚‹éš›ã®å‡¦ç†ã¯ã€ç´ä»˜ã‘ã‚‰ã‚ŒãŸã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã« `GetList()` ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã€
POST ã§ `/users/details` ã¨ã„ã†URLã‚’å—ã‘å–ã‚‹éš›ã®å‡¦ç†ã¯ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã« `PostDetails()` ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½œã‚Šãã®ä¸­ã«å‡¦ç†ã‚’æ›¸ãã¾ã™ã€‚

ã“ã†ã™ã‚‹ã“ã¨ã§ã€**å—ã‘å–ã‚‹æƒ³å®šã®URLã®ã€`app.Party()` ãªã©ã§æœ€åˆã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–æŒ‡å®šã•ã‚ŒãŸç®‡æ‰€ï¼ˆä»Šå›ã¯ã€Œ/usersã€ï¼‰ä»¥é™ã®ãƒ‘ã‚¹åã‚’åå‰ã«æŒã¤ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒ¡ã‚½ãƒƒãƒ‰ã« Iris ãŒè‡ªå‹•ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¾ã™ã€‚**

ã¾ã¨ã‚ã‚‹ã¨ã€ä¾‹ãˆã° `main.go` ãªã©ã§URLã®ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ç´ä»˜ã‘ã‚’ã—ãŸã®ã¡ï¼ˆä»Šå›ã¯ã€Œ/usersã€ï¼‰ã€
- GET ã§ `/users/list` ã¨ã„ã†URLã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒããŸå ´åˆã€Irisï¼ˆã®MVCã‚µãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼‰ãŒè‡ªå‹•ã§ãã‚Œã‚’åˆ¤åˆ¥ã—ã¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã® `GetList()` ã¨ã„ã†åå‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹
- POST ã§ `/users/details` ã¨ã„ã†URLã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒããŸå ´åˆã€Irisï¼ˆã®MVCã‚µãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼‰ãŒè‡ªå‹•ã§ãã‚Œã‚’åˆ¤åˆ¥ã—ã¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã® `PostDetails()` ã¨ã„ã†åå‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹
 
ã¨ãªã‚Šã¾ã™ã€‚

:::message
ã•ã‚‰ã«ã“ã“ã§ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©å†…ã® `PutDetailsBy(id int)`ã€`DeleteDetailsBy(id int)` ã«ã‚‚ã”æ³¨ç›®ãã ã•ã„ã€‚
ä»Šå›ã¯ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã§ `id` ãŒé€ã‚‰ã‚Œã¦æ¥ã¾ã™ãŒã€ï¼ˆ/users/details/{id} ãªã©ï¼‰
**ãƒ¡ã‚½ãƒƒãƒ‰åã®çµ‚ã‚ã‚Šã«ã€ŒByã€ã‚’ä»˜ã‘ã‚‹ã¨è‡ªå‹•ã§ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•°ã«ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®å€¤ãŒå…¥ã‚Šã¾ã™**
:::

```go:controller/users/users_controller.go
package users

import (
    "github.com/kataras/iris/v12"
    "github.com/kataras/iris/v12/mvc"
    "go-iris-sample/model"
    "go-iris-sample/service"
)

type UsersController struct {
	UserService service.UserService
	Ctx         iris.Context
}

// ãƒ¡ã‚½ãƒƒãƒ‰åã§ãƒ‘ã‚¹ã®é•ã„ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘ä»˜ã‘ã¾ã™
// GetList()                GET: "http://localhost:8080/users/list"
// Post()                   POST: "http://localhost:8080/users"
// PutDetails()             PUT: "http://localhost:8080/users/details"
// PutDetailsBy(id uint)    PUT: "http://localhost:8080/users/details/{id:int}"
// DeleteDetails()          DELETE: "http://localhost:8080/users/details"
// DeleteDetailsBy(id uint) DELETE: "http://localhost:8080/users/details/{id:int}"
//
// ãã®ä»–ã®ä¾‹
// POST: http://localhost:8080/users/details/example -> PostDetailsExample()
// PUT: http://localhost:8080/users -> Put()

// GetList ä¸€è¦§å–å¾—
func (c *UsersController) GetList() mvc.Response {
    users, err := c.UserService.GetUserList()
    if err != nil {
        return mvc.Response{
            Code: iris.StatusInternalServerError,
        }
    }
    
    // Iris ã«å‚™ãˆä»˜ãã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨æ§‹é€ ä½“ï¼ˆstructï¼‰
    return mvc.Response{
        Code:   iris.StatusOK,
        Object: users,
    }
}

// Post æ–°è¦ä½œæˆ
func (c *UsersController) Post() mvc.Response {
    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã® json ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Šã€æ§‹é€ ä½“ï¼ˆstructï¼‰ã«æ ¼ç´ã™ã‚‹
    var user model.User
    err := c.Ctx.ReadJSON(&user)
    if err != nil {
        c.Ctx.StopWithError(iris.StatusBadRequest, err)
        return mvc.Response{
            Code: iris.StatusBadRequest,
        }
    }
    
    err = c.UserService.CreateUser(&user)
    if err != nil {
        return mvc.Response{
            Code: iris.StatusInternalServerError,
        }
    }
    
    // Iris å‚™ãˆä»˜ãã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨æ§‹é€ ä½“ï¼ˆstructï¼‰
    return mvc.Response{ Code: iris.StatusCreated }
}

// PutDetailsBy æ›´æ–°
func (c *UsersController) PutDetailsBy(id int) mvc.Response {
    user.Id = id
    err = userService.UpdateUser(&user)
    if err != nil {
        return mvc.Response{
            Code: iris.StatusInternalServerError,
        }
    }
    
    // Iris å‚™ãˆä»˜ãã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨æ§‹é€ ä½“ï¼ˆstructï¼‰
    return mvc.Response{ Code: iris.StatusOK }
}

// DeleteDetailsBy å‰Šé™¤
func (c *UsersController) DeleteDetailsBy(id int) mvc.Response {
    err := c.UserService.DeleteUser(id)
    if err != nil {
        return mvc.Response{
            Code: iris.StatusInternalServerError,
        }
    }
    
    // Iris å‚™ãˆä»˜ãã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨æ§‹é€ ä½“ï¼ˆstructï¼‰
    return mvc.Response{ Code: iris.StatusOK }
}
```

## model/user.go

User æ§‹é€ ä½“ï¼ˆstructï¼‰ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
`db` ã‚¿ã‚°ã¯ORMã‚’ä½¿ã†éš›ã«DBã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã©ã®ã‚«ãƒ©ãƒ ã«å€¤ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã›ã‚‹ã‹ã®æŒ‡ç¤ºã§ã™ã€‚

```go:model/user.go
package model

type User struct {
    Id    string  `json:"id"   db:"id"`
    Name  string  `json:"name" db:"name"`
    Age   uint32  `json:"age"  db:"age"`
}
```

## service/user.go

ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‹ã‚‰ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚Œã‚‹å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚

```go:service/user.go
package service

import (
    "go-iris-sample/_example-mvc-api/model"
    
    _ "github.com/go-sql-driver/mysql"
)

type UserService struct {
	db *gorm.DB
}

func NewUserService(db *gorm.DB) UserService {
	return UserService{db: db}
}

// GetUserList ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å…¨å–å¾—
func (s UserService) GetUserList() ([]model.User, error) {
    var users []model.User
    
    _, err := s.db.Select(&users, `SELECT * FROM users`)
    if err != nil {
        return []model.User{}, err
    }
    
    return users, nil
}

// CreateUser ä½œæˆ
func (s UserService) CreateUser(user *model.User) error {
    tx, _ := s.db.Begin()
    
    err := tx.Insert(user)
    if err != nil {
        tx.Rollback()
        return err
    }
    
    tx.Commit()
    
    return nil
}

// UpdateUser æ›´æ–°
func (s UserService) UpdateUser(user *model.User) error {
    tx, _ := s.db.Begin()
    
    _, err := tx.Update(user)
    if err != nil {
        tx.Rollback()
        return err
    }
    
    tx.Commit()
    
    return nil
}

// DeleteUser å‰Šé™¤
func (s UserService) DeleteUser(id int) error {
    // id ã‹ã‚‰å‰Šé™¤ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
    var user model.User
    err := s.db.SelectOne(&user, `SELECT * FROM users WHERE id = :id`,
        map[string]interface{}{
            "id": id,
        })
    if err != nil {
        fmt.Printf("error! can't find user by id: %v.\n", id)
        return err
    }
    
    tx, _ := s.db.Begin()
    
    _, err := tx.Delete(&user)
    if err != nil {
        tx.Rollback()
        return err
    }
    
    tx.Commit()
    
    return nil
}
```

<br>

ã“ã‚“ãªæ„Ÿã˜ã§ã€Iris ã«å‚™ã‚ã£ãŸæ©Ÿèƒ½ã‚’ä½¿ã„åŠ¹ç‡ã‚ˆãMVCãƒ¢ãƒ‡ãƒ«ã§APIã‚’ä½œã‚Œã¾ã™ã€‚

>  DBæ¥ç¶šè¨­å®šå¾Œ `go run main.go` ã§ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã¦ã€ãã‚Œãã‚Œã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«é©åˆ‡ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã€æ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

é•·ããªã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€ä»¥ä¸Šã«ãªã‚Šã¾ã™ã€‚



[^1]: ã“ã‚Œä»¥å¤–ã« GitBook è£½ã® https://docs.iris-go.com/iris ã‚‚ã‚ã‚Šã¾ã™ã€‚
